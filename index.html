<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }
        .info-card {
            background-color: #f8fafc; /* gray-50 */
            border-left: 4px solid #3b82f6; /* blue-500 */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 lg:p-6">
        <header class="text-center mb-6">
            <h1 class="text-3xl lg:text-4xl font-bold text-blue-600">Bài Học Tương Tác: Tiệm Cận Đồ Thị Hàm Số</h1>
            <p class="text-gray-600 mt-2">Nhập hàm số y = f(x) để vẽ đồ thị và tìm các đường tiệm cận.</p>
        </header>

        <main class="flex flex-col lg:flex-row gap-6" style="min-height: 75vh;">
            <!-- Cột Trái: Trực Quan Hóa Đồ Thị -->
            <div class="lg:w-2/3 w-full bg-white rounded-lg shadow-lg p-4 flex flex-col items-center justify-center">
                <canvas id="graphCanvas" class="w-full h-full rounded-md"></canvas>
            </div>

            <!-- Cột Phải: Điều Khiển và Thông Tin -->
            <div class="lg:w-1/3 w-full flex flex-col gap-4">
                <div class="bg-white rounded-lg shadow-lg p-5">
                    <h2 class="text-xl font-bold mb-3 text-blue-700">Bảng Điều Khiển</h2>
                    
                    <!-- Nhập hàm số -->
                    <div class="mb-4">
                        <label for="functionInput" class="block font-semibold mb-2">Nhập hàm số y = f(x)</label>
                        <div class="flex items-center">
                            <span class="bg-gray-200 p-2 rounded-l-md">y =</span>
                            <input type="text" id="functionInput" placeholder="(2*x + 1) / (x - 1)" class="w-full p-2 border border-gray-300 rounded-r-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
                        </div>
                    </div>
                    
                    <!-- Các nút ví dụ -->
                    <div class="mb-4">
                         <p class="font-semibold mb-2">Hoặc chọn ví dụ:</p>
                         <div class="grid grid-cols-2 gap-2">
                             <button id="example1" class="bg-blue-100 text-blue-800 text-sm p-2 rounded-md hover:bg-blue-200 transition">y = (2x-3)/(x+1)</button>
                             <button id="example2" class="bg-blue-100 text-blue-800 text-sm p-2 rounded-md hover:bg-blue-200 transition">y = (x²-3x+2)/(x-1)</button>
                             <button id="example3" class="bg-blue-100 text-blue-800 text-sm p-2 rounded-md hover:bg-blue-200 transition">y = (x-2)/(x²-1)</button>
                             <button id="example4" class="bg-blue-100 text-blue-800 text-sm p-2 rounded-md hover:bg-blue-200 transition">y = (x²+x)/(x-1)</button>
                         </div>
                    </div>

                    <!-- Nút Vẽ -->
                    <button id="drawButton" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md">
                        Vẽ Đồ Thị & Tìm Tiệm Cận
                    </button>
                    
                    <!-- Nút WolframAlpha -->
                    <button id="wolframButton" class="mt-2 w-full bg-orange-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-600 transition duration-300 shadow-md">
                        Tra cứu với WolframAlpha
                    </button>
                    
                    <!-- Tùy chọn hiển thị -->
                    <div class="mt-4 space-y-2">
                        <h3 class="font-semibold">Tùy chọn hiển thị:</h3>
                        <label class="flex items-center">
                            <input type="checkbox" id="showVertical" class="form-checkbox h-5 w-5 text-blue-600" checked>
                            <span class="ml-2 text-gray-700">Tiệm cận đứng</span>
                        </label>
                         <label class="flex items-center">
                            <input type="checkbox" id="showHorizontal" class="form-checkbox h-5 w-5 text-green-600" checked>
                            <span class="ml-2 text-gray-700">Tiệm cận ngang</span>
                        </label>
                         <label class="flex items-center">
                            <input type="checkbox" id="showSlant" class="form-checkbox h-5 w-5 text-purple-600" checked>
                            <span class="ml-2 text-gray-700">Tiệm cận xiên</span>
                        </label>
                    </div>
                </div>
                
                <!-- Kết quả -->
                <div class="bg-white rounded-lg shadow-lg p-5 flex-grow">
                    <h2 class="text-xl font-bold mb-3 text-blue-700">Kết Quả Phân Tích</h2>
                    <div id="results" class="space-y-2 text-md">
                        <p class="text-gray-500">Nhập hàm số và nhấn vẽ để xem kết quả.</p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Phần hướng dẫn -->
        <footer class="mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-4 text-blue-700">Lý Thuyết & Mẹo Tính Nhanh</h2>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="info-card">
                    <h3 class="font-bold text-lg mb-2">Tiệm Cận Đứng (TCĐ)</h3>
                    <p>Đường thẳng <code class="bg-gray-200 p-1 rounded">x = x₀</code> là TCĐ nếu ít nhất một trong các điều kiện sau được thỏa mãn:</p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li>lim (x→x₀⁺) f(x) = ±∞</li>
                        <li>lim (x→x₀⁻) f(x) = ±∞</li>
                    </ul>
                    <p class="mt-2 text-sm"><b>Mẹo:</b> Nghiệm của mẫu số không là nghiệm của tử số thường là tiệm cận đứng.</p>
                </div>
                <div class="info-card">
                    <h3 class="font-bold text-lg mb-2">Tiệm Cận Ngang (TCN)</h3>
                    <p>Đường thẳng <code class="bg-gray-200 p-1 rounded">y = y₀</code> là TCN nếu:</p>
                     <ul class="list-disc list-inside mt-1 text-sm">
                        <li>lim (x→+∞) f(x) = y₀</li>
                        <li>hoặc lim (x→-∞) f(x) = y₀</li>
                    </ul>
                    <p class="mt-2 text-sm"><b>Mẹo:</b> So sánh bậc của tử và mẫu. Nếu bậc tử < bậc mẫu → TCN y=0. Bậc tử = bậc mẫu → TCN y=a/b (tỉ số hệ số cao nhất).</p>
                </div>
                <div class="info-card">
                    <h3 class="font-bold text-lg mb-2">Tiệm Cận Xiên (TCX)</h3>
                    <p>Đường thẳng <code class="bg-gray-200 p-1 rounded">y = ax + b</code> là TCX nếu:</p>
                     <ul class="list-disc list-inside mt-1 text-sm">
                        <li>a = lim (x→∞) [f(x)/x]</li>
                        <li>b = lim (x→∞) [f(x) - ax]</li>
                    </ul>
                     <p class="mt-2 text-sm"><b>Mẹo:</b> Chỉ xuất hiện khi bậc của tử lớn hơn bậc của mẫu đúng 1 bậc. Có thể tìm bằng cách chia đa thức.</p>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        window.addEventListener('load', () => {
            const canvas = document.getElementById('graphCanvas');
            const ctx = canvas.getContext('2d');
            const functionInput = document.getElementById('functionInput');
            const drawButton = document.getElementById('drawButton');
            const resultsDiv = document.getElementById('results');
            const wolframButton = document.getElementById('wolframButton');
            
            // Example Buttons
            const example1Btn = document.getElementById('example1');
            const example2Btn = document.getElementById('example2');
            const example3Btn = document.getElementById('example3');
            const example4Btn = document.getElementById('example4');

            // Checkboxes
            const showVerticalCheck = document.getElementById('showVertical');
            const showHorizontalCheck = document.getElementById('showHorizontal');
            const showSlantCheck = document.getElementById('showSlant');

            let scale = 40; // pixels per unit
            let originX, originY;
            let func = null;
            let asymptotes = {};
            
            // Resize canvas to fit container
            function resizeCanvas() {
                const container = canvas.parentElement;
                const dpr = window.devicePixelRatio || 1;
                const rect = container.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                canvas.style.width = `${rect.width}px`;
                canvas.style.height = `${rect.height}px`;

                originX = rect.width / 2;
                originY = rect.height / 2;
            }

            // Main draw function
            function draw() {
                if (!ctx) return;
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                drawAxes();
                
                if (asymptotes.vertical && showVerticalCheck.checked) {
                    drawVerticalAsymptotes(asymptotes.vertical);
                }
                if (asymptotes.horizontal !== undefined && showHorizontalCheck.checked) {
                    drawHorizontalAsymptote(asymptotes.horizontal);
                }
                if (asymptotes.slant && showSlantCheck.checked) {
                    drawSlantAsymptote(asymptotes.slant);
                }
                if (func) {
                    drawFunction(func);
                }
            }

            function drawAxes() {
                ctx.strokeStyle = '#ccc';
                ctx.lineWidth = 1;
                ctx.beginPath();
                // X-axis
                ctx.moveTo(0, originY);
                ctx.lineTo(canvas.width, originY);
                // Y-axis
                ctx.moveTo(originX, 0);
                ctx.lineTo(originX, canvas.height);
                ctx.stroke();

                // Ticks and labels
                ctx.fillStyle = '#999';
                ctx.font = '12px Be Vietnam Pro';
                // X-axis ticks
                for (let i = Math.floor(-originX / scale); i <= Math.floor((canvas.width - originX) / scale); i++) {
                    if (i === 0) continue;
                    const x = originX + i * scale;
                    ctx.beginPath();
                    ctx.moveTo(x, originY - 5);
                    ctx.lineTo(x, originY + 5);
                    ctx.stroke();
                    ctx.fillText(i, x - 5, originY + 20);
                }
                // Y-axis ticks
                for (let i = Math.floor(-originY / scale); i <= Math.floor((canvas.height - originY) / scale); i++) {
                     if (i === 0) continue;
                    const y = originY - i * scale;
                    ctx.beginPath();
                    ctx.moveTo(originX - 5, y);
                    ctx.lineTo(originX + 5, y);
                    ctx.stroke();
                    if (i !== 0) ctx.fillText(i, originX + 10, y + 5);
                }
                ctx.fillText('0', originX - 15, originY + 15);
            }
            
            function drawFunction(fn) {
                ctx.strokeStyle = '#007bff';
                ctx.lineWidth = 2.5;
                let lastY = null;

                ctx.beginPath(); 

                for (let px = 0; px <= canvas.width; px++) {
                    const x = (px - originX) / scale;
                    let y;
                    try {
                        y = fn(x);
                    } catch(e) {
                        lastY = null;
                        continue;
                    }

                    if (isFinite(y)) {
                        const py = originY - y * scale;
                        if (lastY !== null && Math.abs(py - lastY) < canvas.height / 2) { 
                            ctx.lineTo(px, py);
                        } else {
                            ctx.moveTo(px, py);
                        }
                        lastY = py;
                    } else {
                         lastY = null;
                    }
                }
                ctx.stroke();
            }

            function drawVerticalAsymptotes(vas) {
                ctx.strokeStyle = '#ef4444'; // red-500
                ctx.lineWidth = 1.5;
                ctx.setLineDash([5, 5]);
                vas.forEach(x0 => {
                    const px = originX + x0 * scale;
                    ctx.beginPath();
                    ctx.moveTo(px, 0);
                    ctx.lineTo(px, canvas.height);
                    ctx.stroke();
                    
                    ctx.fillStyle = '#ef4444';
                    ctx.font = '14px Be Vietnam Pro';
                    ctx.fillText(`x = ${x0}`, px + 5, 20);
                });
                ctx.setLineDash([]);
            }

            function drawHorizontalAsymptote(y0) {
                ctx.strokeStyle = '#22c55e'; // green-500
                ctx.lineWidth = 1.5;
                ctx.setLineDash([5, 5]);
                const py = originY - y0 * scale;
                ctx.beginPath();
                ctx.moveTo(0, py);
                ctx.lineTo(canvas.width, py);
                ctx.stroke();
                
                ctx.fillStyle = '#22c55e';
                ctx.font = '14px Be Vietnam Pro';
                ctx.fillText(`y = ${y0.toFixed(2)}`, 10, py - 10);
                ctx.setLineDash([]);
            }

            function drawSlantAsymptote(sa) {
                ctx.strokeStyle = '#a855f7'; // purple-500
                ctx.lineWidth = 1.5;
                ctx.setLineDash([5, 5]);
                
                const y1 = sa.m * (0 - originX) / scale + sa.b;
                const y2 = sa.m * (canvas.width - originX) / scale + sa.b;
                
                const px1 = 0;
                const py1 = originY - y1 * scale;
                const px2 = canvas.width;
                const py2 = originY - y2 * scale;
                
                ctx.beginPath();
                ctx.moveTo(px1, py1);
                ctx.lineTo(px2, py2);
                ctx.stroke();
                
                ctx.fillStyle = '#a855f7';
                ctx.font = '14px Be Vietnam Pro';
                ctx.fillText(`y = ${sa.m.toFixed(2)}x + ${sa.b.toFixed(2)}`, canvas.width - 200, py2 + 20);
                ctx.setLineDash([]);
            }

            function analyzeFunction(str) {
                let f;
                try {
                    f = new Function('x', `with(Math){ return ${str.replace(/\^/g, '**')}; }`);
                    f(1);
                } catch (e) {
                    resultsDiv.innerHTML = '<p class="text-red-500 font-semibold">Hàm số không hợp lệ. Vui lòng kiểm tra lại.</p>';
                    return { func: null, asymptotes: {} };
                }

                const calculatedAsymptotes = {};
                const limitTest = 1e6;
                
                const yPlusInf = f(limitTest);
                const yMinusInf = f(-limitTest);
                
                if (Math.abs(yPlusInf) < limitTest && Math.abs(yPlusInf - yMinusInf) < 0.1) {
                     calculatedAsymptotes.horizontal = yPlusInf;
                }

                if (!('horizontal' in calculatedAsymptotes)) {
                    const m_plus = f(limitTest) / limitTest;
                    const m_minus = f(-limitTest) / (-limitTest);

                    if (Math.abs(m_plus) > 1e-6 && Math.abs(m_plus) < limitTest && Math.abs(m_plus - m_minus) < 0.1) {
                        const m = Math.round(m_plus);
                        const b_plus = f(limitTest) - m * limitTest;
                        const b_minus = f(-limitTest) - m * (-limitTest);
                        
                        if (Math.abs(b_plus) < limitTest && Math.abs(b_plus - b_minus) < 0.1) {
                            const b = (b_plus + b_minus) / 2;
                            calculatedAsymptotes.slant = { m, b };
                        }
                    }
                }
                
                let vas = [];
                let lastY = f(-10);
                for(let x = -10; x <= 10; x+=0.01) {
                    let currentY = f(x);
                    if(Math.abs(currentY) > 50 && Math.sign(currentY) !== Math.sign(lastY)) {
                        let x0 = parseFloat(x.toFixed(2));
                        if (!vas.includes(x0)) vas.push(x0);
                    }
                    lastY = currentY;
                }
                calculatedAsymptotes.vertical = vas;

                return { func: f, asymptotes: calculatedAsymptotes };
            }

            function updateResultsUI(asymptotes) {
                resultsDiv.innerHTML = '';
                if (Object.keys(asymptotes).length === 0 && !func) {
                    resultsDiv.innerHTML = '<p class="text-gray-500">Chưa có phân tích.</p>';
                    return;
                }

                let hasAsymptote = false;

                if (asymptotes.vertical && asymptotes.vertical.length > 0 && showVerticalCheck.checked) {
                    hasAsymptote = true;
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>Tiệm cận đứng: </strong> <span class="text-red-600 font-semibold">${asymptotes.vertical.map(x => `x = ${x}`).join(', ')}</span>`;
                    resultsDiv.appendChild(p);
                }
                
                if (asymptotes.horizontal !== undefined && isFinite(asymptotes.horizontal) && showHorizontalCheck.checked) {
                    hasAsymptote = true;
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>Tiệm cận ngang: </strong> <span class="text-green-600 font-semibold">y = ${asymptotes.horizontal.toFixed(4)}</span>`;
                    resultsDiv.appendChild(p);
                }

                if (asymptotes.slant && showSlantCheck.checked) {
                    hasAsymptote = true;
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>Tiệm cận xiên: </strong> <span class="text-purple-600 font-semibold">y = ${asymptotes.slant.m.toFixed(2)}x + ${asymptotes.slant.b.toFixed(2)}</span>`;
                    resultsDiv.appendChild(p);
                }

                if (!hasAsymptote) {
                     resultsDiv.innerHTML = '<p class="text-gray-600">Không tìm thấy tiệm cận phù hợp với các tùy chọn.</p>';
                }
            }
            
            function handleDraw() {
                const analysis = analyzeFunction(functionInput.value);
                func = analysis.func;
                asymptotes = analysis.asymptotes;
                updateResultsUI(asymptotes);
                draw();
            }
            
            function setExample(exampleFunc) {
                functionInput.value = exampleFunc;
                handleDraw();
            }

            function openWolframAlpha() {
                const funcStr = functionInput.value;
                if (!funcStr.trim()) {
                    return;
                }
                const query = `plot and asymptotes of y = ${funcStr}`;
                const encodedQuery = encodeURIComponent(query);
                const url = `https://www.wolframalpha.com/input?i=${encodedQuery}`;
                window.open(url, '_blank');
            }

            // Event Listeners
            drawButton.addEventListener('click', handleDraw);
            wolframButton.addEventListener('click', openWolframAlpha);
            
            example1Btn.addEventListener('click', () => setExample('(2*x-3)/(x+1)'));
            example2Btn.addEventListener('click', () => setExample('(x**2 - 3*x + 2)/(x-1)'));
            example3Btn.addEventListener('click', () => setExample('(x-2)/(x**2-1)'));
            example4Btn.addEventListener('click', () => setExample('(x**2+x)/(x-1)'));

            functionInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleDraw();
                }
            });
            
            [showVerticalCheck, showHorizontalCheck, showSlantCheck].forEach(check => {
                check.addEventListener('change', () => {
                     updateResultsUI(asymptotes);
                     draw();
                });
            });

            window.addEventListener('resize', () => {
                resizeCanvas();
                draw();
            });

            // Initial setup
            resizeCanvas();
            setExample('(2*x-3)/(x+1)');
        });
    </script>
</body>
</html>
